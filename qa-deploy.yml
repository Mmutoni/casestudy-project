---
- hosts: ws
  become: yes
  become_user: root 
  ignore_errors: yes
  tasks:
   - name: delete old artifact
      file:
        path: /opt/qa/spg/*.jar
        state: absent

    - name: get PID
      file:
       shell: 8082: lsof -i :8082 
       register: pid_output

    - name: kill running app
      shell: kill -9 pid_outpu.stdout
      when: kill -9 pid_outpu.stdout != ''

    - name: Download new artfact
      get_url:
        url: http://34.201.161.49:8081/artifactory/geolocation/geo/bio_17.jar
        dest: /opt/qa/spg 
        url_username: admin
        url_password: password

    - name: Run the App
      shell: nohup java -jar /opt/qa/spg/*.jar > /opt/qa/spg.log 2>&1 &
                    